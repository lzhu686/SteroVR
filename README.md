# RGB125 双目立体视觉 VR 系统

基于 USB 双目相机的实时立体视觉 VR 透视系统，支持 WebXR 标准，兼容多种 VR 设备。

## ✨ 特性

- 🎯 **一键启动**: 简化的启动流程，只需一个命令
- 🔒 **安全加密**: 自动配置 HTTPS + WSS 加密传输
- 📱 **跨设备支持**: 支持 Quest 3、PICO 4、Vision Pro 等主流 VR 设备
- ⚡ **高性能**: 60fps 实时传输，低延迟优化
- 🎨 **双目立体**: 125° 视场角，60mm 基线距离

## 🎮 支持的 VR 设备

| 设备 | 状态 |
|------|------|
| Meta Quest 3 / Quest Pro | ✅ 完全支持 |
| Meta Quest 2 | ✅ 支持 |
| PICO 4 / PICO Neo3 | ✅ 支持 |
| Apple Vision Pro | ✅ 支持 |
| HTC Vive / Vive Pro | ✅ 支持 |
| Valve Index | ✅ 支持 |
| 其他 WebXR 兼容设备 | ✅ 支持 |

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install opencv-python websockets numpy
```

### 2. 启动服务器

```bash
python start.py
```

服务器会自动：
- ✅ 生成 SSL 证书（如果不存在）
- ✅ 启动 HTTPS 文件服务器（端口 8445）
- ✅ 启动 WSS WebSocket 服务器（端口 8765）
- ✅ 显示访问地址和说明

### 3. 在 VR 设备中访问

在 VR 头显浏览器中打开：
```
https://你的电脑IP:8445
```

**示例**: `https://192.168.1.100:8445`

**首次访问**：
1. 浏览器提示"证书不安全" - 点击"高级"→"继续访问"
2. 进入导航页面，点击 **"进入VR模式"** 按钮
3. 页面自动连接视频流，点击"进入 VR"开始体验

## 📁 项目结构

```
SteroVR/
├── start.py              # 🚀 主启动脚本（只需运行这个！）
├── server.py             # WebSocket 服务器核心代码
├── index.html            # 🏠 主页导航（VR设备访问入口）
├── README.md             # 📖 完整文档
├── QUICK_START.md        # ⚡ 快速上手指南
│
├── web/                  # 前端应用文件
│   ├── dual_infrared_viewer.html      # 普通2D查看器
│   └── dual_infrared_vr_viewer.html   # VR 立体查看器
│
├── server.crt            # SSL 证书（自动生成）
└── server.key            # SSL 私钥（自动生成）
```

## ⚙️ 配置参数

如需调整相机参数，编辑 `server.py` 文件顶部：

```python
STEREO_WIDTH = 2560     # 双目拼接图像宽度
STEREO_HEIGHT = 720     # 双目拼接图像高度
CAMERA_WIDTH = 1280     # 单目图像宽度
CAMERA_HEIGHT = 720     # 单目图像高度
TARGET_FPS = 60         # 目标帧率
JPEG_QUALITY = 100      # JPEG压缩质量 (1-100)
```

## 🔧 故障排除

### WebSocket 连接失败

**现象**: 页面显示 "WebSocket: 未连接"

**解决方法**:
1. 确保 Python 服务器已启动
2. 检查防火墙是否允许 8445 和 8765 端口
3. 确保 VR 设备与电脑在同一局域网

### VR 模式下只显示单目画面

**现象**: 进入 VR 模式后，左右眼显示相同的画面

**解决方法**:
1. 退出 VR 模式（按菜单键）
2. 刷新浏览器页面
3. 重新点击"进入 VR"按钮

### 证书警告

**现象**: 浏览器提示"您的连接不是私密连接"

**解决方法**:
1. 这是正常现象（使用自签名证书）
2. 点击"高级"或"显示详情"
3. 选择"继续前往"或"仍然访问"

### 相机无法打开

**现象**: 服务器显示"启用测试模式"

**解决方法**:
- 检查相机是否正确连接到 USB 3.0 端口
- 如果只是测试系统，测试模式会生成虚拟画面供预览

## 🌐 端口说明

| 端口 | 用途 | 协议 |
|------|------|------|
| 8445 | 文件服务器 | HTTPS |
| 8765 | 视频流传输 | WSS (WebSocket over SSL) |

## 📖 使用提示

1. **本地开发**: 可以直接用浏览器打开 `web/` 目录下的 HTML 文件进行预览
2. **远程访问**: 必须通过 HTTPS 访问才能使用 WebXR（VR 功能）
3. **网络性能**: 建议使用 5GHz WiFi 或有线网络以获得最佳性能
4. **多客户端**: 支持多个设备同时连接观看

## 🔐 系统架构

```
┌──────────────┐      ┌────────────────────┐      ┌─────────────┐
│ USB双目相机   │  →   │ Python 服务器      │  →   │ VR浏览器    │
│ (2560x720)   │      │ HTTPS:8445         │      │ (WebXR)     │
│              │      │ WSS:8765           │      │             │
└──────────────┘      └────────────────────┘      └─────────────┘
       │                       │                        │
  OpenCV采集             SSL加密传输              Three.js渲染
  分割左右图像            Base64编码              WebXR立体显示
```

## 👨‍💻 作者

**Liang ZHU**
Email: lzhu686@connect.hkust-gz.edu.cn

## 📄 许可证

MIT License

---

## 💡 开发者说明

如需查看旧版本或其他启动方式，请查看 `deprecated/` 文件夹。

**推荐**: 只使用 `start.py` 启动，它已经整合了所有必要功能。

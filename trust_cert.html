<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSLè¯ä¹¦ä¿¡ä»»é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .step {
            background: rgba(255,255,255,0.1);
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .warning {
            background: rgba(255,193,7,0.2);
            border-left-color: #ff9800;
        }
        .success {
            background: rgba(76,175,80,0.2);
            border-left-color: #4CAF50;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .test-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .test-success {
            background: rgba(76,175,80,0.3);
            border: 1px solid #4CAF50;
        }
        .test-error {
            background: rgba(244,67,54,0.3);
            border: 1px solid #f44336;
        }
    </style>
</head>
<body>
    <h1>ğŸ” SSLè¯ä¹¦ä¿¡ä»»è®¾ç½®</h1>
    
    <div class="step warning">
        <h3>âš ï¸ é‡è¦è¯´æ˜</h3>
        <p>WebXRç³»ç»Ÿä½¿ç”¨è‡ªç­¾åSSLè¯ä¹¦ã€‚ä¸ºäº†ä½¿WebSocketè¿æ¥æ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦åœ¨æµè§ˆå™¨ä¸­ä¿¡ä»»ä¸¤ä¸ªç«¯å£çš„è¯ä¹¦ï¼š</p>
        <ul>
            <li><strong>ç«¯å£8443</strong>ï¼šHTTPSç½‘é¡µæœåŠ¡å™¨ï¼ˆæ‚¨å·²ç»ä¿¡ä»»ï¼‰</li>
            <li><strong>ç«¯å£8765</strong>ï¼šWSS WebSocketæœåŠ¡å™¨ï¼ˆéœ€è¦å•ç‹¬ä¿¡ä»»ï¼‰</li>
        </ul>
    </div>

    <div class="step">
        <h3>ğŸ“‹ è®¾ç½®æ­¥éª¤</h3>
        
        <h4>æ­¥éª¤1ï¼šæµ‹è¯•å½“å‰çŠ¶æ€</h4>
        <button onclick="testWebSocketConnection()">ğŸ§ª æµ‹è¯•WebSocketè¿æ¥</button>
        <button onclick="testHTTPSConnection()">ğŸŒ æµ‹è¯•HTTPSè¿æ¥</button>
        <button onclick="testRobotConnection()">ğŸ¤– æµ‹è¯•æœºå™¨äººåç«¯è¿æ¥</button>
        
        <div id="testResult" class="test-result"></div>
        
        <h4>æ­¥éª¤2ï¼šä¿¡ä»»WebSocketè¯ä¹¦</h4>
        <p>ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥ï¼Œåœ¨æ–°æ ‡ç­¾é¡µä¸­ä¿¡ä»»8080ç«¯å£çš„SSLè¯ä¹¦ï¼š</p>
        <button onclick="openWebSocketCert()">ğŸ”— æ‰“å¼€WebSocketè¯ä¹¦é¡µé¢</button>
        
        <h4>æ­¥éª¤3ï¼šè¿”å›ä¸»é¡µé¢</h4>
        <p>è¯ä¹¦ä¿¡ä»»å®Œæˆåï¼Œè¿”å›ä¸»é¡µé¢ï¼š</p>
        <button onclick="goToMainPage()">ğŸ  è¿”å›ä¸»é¡µé¢</button>
    </div>

    <div class="step success">
        <h3>âœ… éªŒè¯æˆåŠŸ</h3>
        <p>å½“WebSocketè¿æ¥æµ‹è¯•æ˜¾ç¤º"æˆåŠŸ"æ—¶ï¼Œæ‚¨å¯ä»¥æ­£å¸¸ä½¿ç”¨WebXRæ‰‹éƒ¨è·Ÿè¸ªåŠŸèƒ½äº†ã€‚</p>
    </div>

    <script>
        function openWebSocketCert() {
            const port = 8765;
            const url = `https://${window.location.hostname}:${port}/`;
            window.open(url, '_blank');
            
            // æ˜¾ç¤ºæŒ‡å¯¼ä¿¡æ¯
            showResult('info', `
                å·²æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼š${url}<br>
                <strong>è¯·åœ¨æ–°æ ‡ç­¾é¡µä¸­ï¼š</strong><br>
                1. ç‚¹å‡»"é«˜çº§"æˆ–"Advanced"<br>
                2. ç‚¹å‡»"ç»§ç»­å‰å¾€..."æˆ–"Proceed to..."<br>
                3. ä¿¡ä»»æ­¤è¯ä¹¦<br>
                4. å…³é—­æ–°æ ‡ç­¾é¡µï¼Œè¿”å›æ­¤é¡µé¢é‡æ–°æµ‹è¯•
            `);
        }
        
        function goToMainPage() {
            window.location.href = '/index.html';
        }
        
        async function testHTTPSConnection() {
            try {
                const response = await fetch(`https://${window.location.hostname}:8443/`);
                if (response.ok) {
                    showResult('success', 'âœ… HTTPSè¿æ¥æ­£å¸¸');
                } else {
                    showResult('error', 'âŒ HTTPSè¿æ¥å¤±è´¥');
                }
            } catch (error) {
                showResult('error', `âŒ HTTPSè¿æ¥é”™è¯¯: ${error.message}`);
            }
        }
        
        async function testWebSocketConnection() {
            try {
                const wsUrl = `wss://${window.location.hostname}:8765/`;
                const websocket = new WebSocket(wsUrl);
                
                websocket.onopen = () => {
                    showResult('success', 'âœ… WebSocketè¿æ¥æˆåŠŸï¼å¯ä»¥æ­£å¸¸ä½¿ç”¨WebXRåŠŸèƒ½ã€‚');
                    websocket.close();
                };
                
                websocket.onerror = (error) => {
                    showResult('error', `âŒ WebSocketè¿æ¥å¤±è´¥ã€‚è¯·ç‚¹å‡»"æ‰“å¼€WebSocketè¯ä¹¦é¡µé¢"æŒ‰é’®ä¿¡ä»»è¯ä¹¦ã€‚`);
                };
                
                // è¶…æ—¶å¤„ç†
                setTimeout(() => {
                    if (websocket.readyState === WebSocket.CONNECTING) {
                        websocket.close();
                        showResult('error', 'âŒ WebSocketè¿æ¥è¶…æ—¶ã€‚è¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ã€‚');
                    }
                }, 5000);
                
            } catch (error) {
                showResult('error', `âŒ WebSocketæµ‹è¯•é”™è¯¯: ${error.message}`);
            }
        }

        async function testRobotConnection() {
            try {
                const wsUrl = `wss://${window.location.hostname}:8080/`;
                const websocket = new WebSocket(wsUrl);
                
                websocket.onopen = () => {
                    // å‘é€æœºå™¨äººæ³¨å†Œæ¶ˆæ¯
                    const registrationMessage = {
                        type: 'register',
                        client_type: 'robot',
                        timestamp: Date.now()
                    };
                    websocket.send(JSON.stringify(registrationMessage));
                    
                    // å‘é€çŠ¶æ€æ¶ˆæ¯æµ‹è¯•
                    setTimeout(() => {
                        const statusMessage = {
                            type: 'status',
                            message: 'æµ‹è¯•æœºå™¨äººè¿æ¥',
                            timestamp: Date.now()
                        };
                        websocket.send(JSON.stringify(statusMessage));
                        
                        showResult('success', 'âœ… æœºå™¨äººåç«¯è¿æ¥æµ‹è¯•æˆåŠŸï¼ç³»ç»Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚');
                        websocket.close();
                    }, 1000);
                };
                
                websocket.onerror = (error) => {
                    showResult('error', `âŒ æœºå™¨äººåç«¯è¿æ¥æµ‹è¯•å¤±è´¥ã€‚è¯·ç¡®ä¿WebSocketè¯ä¹¦å·²ä¿¡ä»»ä¸”æœåŠ¡å™¨æ­£åœ¨è¿è¡Œã€‚`);
                };
                
                // è¶…æ—¶å¤„ç†
                setTimeout(() => {
                    if (websocket.readyState === WebSocket.CONNECTING) {
                        websocket.close();
                        showResult('error', 'âŒ æœºå™¨äººåç«¯è¿æ¥æµ‹è¯•è¶…æ—¶ã€‚');
                    }
                }, 5000);
                
            } catch (error) {
                showResult('error', `âŒ æœºå™¨äººåç«¯è¿æ¥æµ‹è¯•é”™è¯¯: ${error.message}`);
            }
        }
        
        function showResult(type, message) {
            const resultDiv = document.getElementById('testResult');
            resultDiv.style.display = 'block';
            resultDiv.className = `test-result test-${type === 'success' ? 'success' : 'error'}`;
            resultDiv.innerHTML = message;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            console.log('SSLè¯ä¹¦ä¿¡ä»»é¡µé¢å·²åŠ è½½');
        }
    </script>
</body>
</html> 